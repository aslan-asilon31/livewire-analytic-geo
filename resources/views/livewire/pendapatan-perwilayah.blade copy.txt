<div>
    <!-- HEADER -->
    <x-header title="Pendapatan per Wilayah" separator progress-indicator>
        <x-slot:middle class="!justify-end">
            <x-input placeholder="Search..." wire:model.live.debounce="search" clearable icon="o-magnifying-glass" />
        </x-slot:middle>
    </x-header>

    <!-- Peta -->
    <div id="map" style="height: 500px;"></div>

    <!-- Grafik Pendapatan per Wilayah -->
    <div class="mt-4">
        <canvas id="pendapatanPerWilayah"></canvas>
    </div>


        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // Inisialisasi peta
        var map = L.map('map').setView([0, 120], 5); // Set lokasi peta Indonesia (latitude, longitude)

        // Menambahkan Tile Layer (peta dasar)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Data Lokasi dan Penjualan
        var locations = @json($locations);  // Mengambil data dari Livewire

        // Menambahkan marker untuk setiap lokasi
        locations.forEach(function(location) {
            L.marker([location.latitude, location.longitude])
                .addTo(map)
                .bindPopup("<b>" + location.city + "</b><br>Sales: Rp " + location.sales.toLocaleString())
                .openPopup();
        });

        // Grafik Chart.js untuk Pendapatan per Wilayah
        var ctx = document.getElementById('pendapatanPerWilayah').getContext('2d');
        var pendapatanPerWilayah = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: locations.map(location => location.city),  // Nama kota
                datasets: [{
                    label: 'Pendapatan (Rp)',
                    data: locations.map(location => location.sales),  // Pendapatan
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
</div>
